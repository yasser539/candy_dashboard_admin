# نظام الروابط المباشرة للصور

## المشكلة السابقة
كان النظام يحفظ فقط المسار المحلي للصور في قاعدة البيانات مثل:
```
ads/1754343268635-screenshot_2025-08-03_at_7.33.16_pm.png
```

## الحل الجديد
الآن النظام يحفظ الرابط النهائي المباشر في قاعدة البيانات مثل:
```
https://[project-ref].supabase.co/storage/v1/object/public/img/ads/1754343268635-screenshot_2025-08-03_at_7.33.16_pm.png
```

## كيفية عمل النظام

### 1. رفع الصورة
عند رفع صورة جديدة، النظام يقوم بـ:
- رفع الصورة إلى Supabase Storage
- الحصول على الرابط العام المباشر
- حفظ الرابط المباشر في قاعدة البيانات

### 2. الصيغة العامة للرابط
```
https://<project-ref>.supabase.co/storage/v1/object/public/<bucket>/<path>
```

حيث:
- `<project-ref>`: كود مشروع Supabase
- `<bucket>`: اسم البكت (img)
- `<path>`: مسار الصورة داخل البكت (ads/اسم-الصورة)

### 3. التحديثات المطلوبة

#### في ملف `supabase-services.ts`:
- تحديث دالة `uploadAdImage` لتعيد الرابط العام المباشر
- تحديث دالة `createAd` لتحفظ الرابط المباشر

#### في ملف `notifications/page.tsx`:
- تحديث دالة `handleCreateItem` لاستخدام الرابط المباشر
- تحديث دالة `getImageUrl` للتعامل مع الروابط المباشرة

### 4. مثال عملي

#### قبل التحديث:
```javascript
// حفظ المسار المحلي
image_url: "ads/1754343268635-screenshot.png"
```

#### بعد التحديث:
```javascript
// حفظ الرابط المباشر
image_url: "https://abcd1234.supabase.co/storage/v1/object/public/img/ads/1754343268635-screenshot.png"
```

### 5. المزايا

1. **سرعة الوصول**: لا حاجة لتحويل المسار إلى رابط في كل مرة
2. **سهولة الاستخدام**: الرابط جاهز للاستخدام مباشرة
3. **توافق أفضل**: يعمل مع جميع المتصفحات والتطبيقات
4. **أداء أفضل**: تقليل العمليات الحسابية

### 6. التوافق مع البيانات الموجودة

النظام يدعم كلا النوعين:
- الروابط المباشرة الجديدة
- المسارات المحلية القديمة (يتم تحويلها تلقائياً)

### 7. كيفية الحصول على project-ref

يمكنك الحصول على project-ref من:
1. إعدادات مشروع Supabase
2. عنوان URL في لوحة التحكم
3. متغيرات البيئة `NEXT_PUBLIC_SUPABASE_URL`

مثال: إذا كان URL هو `https://abcd1234.supabase.co`، فإن project-ref هو `abcd1234` 