"use client";

import { useState, useEffect } from "react";
import Layout from "../components/Layout";
import { useAuth } from "../context/AuthContext";
import { supabase } from "../../lib/supabase";
import { 
  Bell, 
  Megaphone, 
  AlertTriangle, 
  Plus, 
  Edit, 
  Trash2, 
  Eye, 
  EyeOff,
  Upload,
  Calendar,
  Users,
  Target,
  BarChart3,
  RefreshCw,
  CheckCircle,
  XCircle,
  Clock,
  Star,
  X,
  Image as ImageIcon,
  Type
} from "lucide-react";
import { Card, CardHeader, CardTitle, CardContent, CardFooter } from "../../components/ui/card";
import { Button } from "../../components/ui/button";

interface Ad {
  id: string;
  image_url: string;
  created_at: string;
}

interface Notification {
  id: string;
  message: string;
  created_at: string;
}

interface Slogan {
  id: string;
  title: string;
  slogan_text: string;
  created_at: string;
}

interface NotificationStats {
  totalAds: number;
  totalNotifications: number;
  totalSlogans: number;
}

export default function NotificationsPage() {
  const { user } = useAuth();
  const [activeTab, setActiveTab] = useState<'ads' | 'notifications' | 'slogans'>('ads');
  const [ads, setAds] = useState<Ad[]>([]);
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [slogans, setSlogans] = useState<Slogan[]>([]);
  const [stats, setStats] = useState<NotificationStats>({
    totalAds: 0,
    totalNotifications: 0,
    totalSlogans: 0
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [editingItem, setEditingItem] = useState<Ad | Notification | Slogan | null>(null);
  const [modalType, setModalType] = useState<'ad' | 'notification' | 'slogan'>('ad');
  const [selectedImage, setSelectedImage] = useState<File | null>(null);
  const [imagePreview, setImagePreview] = useState<string>('');
  const [formData, setFormData] = useState({
    title: '',
    message: '',
    slogan_text: ''
  });

  // ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  const fetchData = async () => {
    try {
      setLoading(true);
      setError(null);

      console.log('üîç Starting to fetch notifications data...');

      // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ© ŸÖÿ§ŸÇÿ™ÿ© ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ
      const mockAds: Ad[] = [
        {
          id: '1',
          image_url: 'https://images.unsplash.com/photo-1481391319762-47dff72954d9?w=400',
          created_at: new Date().toISOString()
        },
        {
          id: '2',
          image_url: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400',
          created_at: new Date().toISOString()
        },
        {
          id: '3',
          image_url: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400',
          created_at: new Date().toISOString()
        }
      ];

      const mockNotifications: Notification[] = [
        {
          id: '1',
          message: 'ÿµŸäÿßŸÜÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ∫ÿØÿßŸã ŸÖŸÜ 2-4 ÿµÿ®ÿßÿ≠ÿßŸã',
          created_at: new Date().toISOString()
        },
        {
          id: '2',
          message: 'ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ÿØŸäÿØ ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ™ÿßÿ≠ ÿßŸÑÿ¢ŸÜ',
          created_at: new Date().toISOString()
        },
        {
          id: '3',
          message: 'ÿπÿ±ÿ∂ ÿÆÿßÿµ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÑŸàŸäÿßÿ™ 20% ÿÆÿµŸÖ',
          created_at: new Date().toISOString()
        }
      ];

      const mockSlogans: Slogan[] = [
        {
          id: '1',
          title: 'ÿ¥ÿπÿßÿ± ÿßŸÑÿ¥ÿ±ŸÉÿ©',
          slogan_text: 'ŸÜÿ≠ŸÖŸÑ ÿßŸÑŸÖÿßÿ° ÿ•ŸÑŸâ ÿ®ÿßÿ®ŸÉ ÿ®ŸÉŸÑ ÿ≥ŸáŸàŸÑÿ© Ÿàÿ£ŸÖÿßŸÜÿå ÿÆÿØŸÖÿ© 24 ÿ≥ÿßÿπÿ© ÿπŸÑŸâ ŸÖÿØÿßÿ± ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ',
          created_at: new Date().toISOString()
        },
        {
          id: '2',
          title: 'ÿ¥ÿπÿßÿ± ÿßŸÑÿ™ŸàÿµŸäŸÑ',
          slogan_text: 'ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ Ÿàÿ¢ŸÖŸÜÿå ŸÜÿ∂ŸÖŸÜ ŸÑŸÉ ŸàÿµŸàŸÑ ÿ∑ŸÑÿ®ŸÉ ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ≠ÿØÿØ Ÿàÿ®ÿ£ŸÅÿ∂ŸÑ ÿ¨ŸàÿØÿ©',
          created_at: new Date().toISOString()
        }
      ];

      // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
      try {
        console.log('üìä Attempting to fetch from database...');
        const { data: adsData, error: adsError } = await supabase
          .from('ads')
          .select('*')
          .order('created_at', { ascending: false });

        const { data: notificationsData, error: notificationsError } = await supabase
          .from('notifications')
          .select('*')
          .order('created_at', { ascending: false });

        const { data: slogansData, error: slogansError } = await supabase
          .from('slogans')
          .select('*')
          .order('created_at', { ascending: false });

        // ÿ•ÿ∞ÿß ŸÜÿ¨ÿ≠ ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖŸáÿß
        if (!adsError && !notificationsError && !slogansError) {
          console.log('‚úÖ Database data fetched successfully');
          setAds(adsData || []);
          setNotifications(notificationsData || []);
          setSlogans(slogansData || []);
        } else {
          // ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
          console.log('‚ö†Ô∏è  Using mock data (database tables not found)');
          setAds(mockAds);
          setNotifications(mockNotifications);
          setSlogans(mockSlogans);
        }
      } catch (dbError) {
        console.log('‚ö†Ô∏è  Database error, using mock data:', dbError);
        setAds(mockAds);
        setNotifications(mockNotifications);
        setSlogans(mockSlogans);
      }

      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
      const currentAds = ads.length > 0 ? ads : mockAds;
      const currentNotifications = notifications.length > 0 ? notifications : mockNotifications;
      const currentSlogans = slogans.length > 0 ? slogans : mockSlogans;
      
      const totalAds = currentAds.length;
      const totalNotifications = currentNotifications.length;
      const totalSlogans = currentSlogans.length;

      setStats({
        totalAds,
        totalNotifications,
        totalSlogans
      });

      console.log('üìà Stats calculated:', {
        totalAds,
        totalNotifications,
        totalSlogans
      });

    } catch (error: unknown) {
      console.error('‚ùå Error in fetchData:', error);
      setError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸàÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const resetForm = () => {
    setFormData({
      title: '',
      message: '',
      slogan_text: ''
    });
    setSelectedImage(null);
    setImagePreview('');
    setModalType('ad');
  };

  const handleCreateItem = async () => {
    try {
      if (modalType === 'ad') {
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ (ÿµŸàÿ±ÿ© ŸÅŸÇÿ∑)
        const newAd: Ad = {
          id: Date.now().toString(),
          image_url: imagePreview || 'https://images.unsplash.com/photo-1481391319762-47dff72954d9?w=400',
          created_at: new Date().toISOString()
        };

        // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        console.log('üîÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ•ŸÑŸâ Supabase...');
        const { data: insertedAd, error } = await supabase
          .from('ads')
          .insert([{
            image_url: imagePreview || 'https://images.unsplash.com/photo-1481391319762-47dff72954d9?w=400'
          }])
          .select();

        if (error) {
          console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ•ŸÑŸâ Supabase:', error);
          console.log('‚ö†Ô∏è  ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≠ŸÑŸäÿßŸã ŸÅŸÇÿ∑');
          setAds(prevAds => [newAd, ...prevAds]);
        } else {
          console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ•ŸÑŸâ Supabase ÿ®ŸÜÿ¨ÿßÿ≠:', insertedAd);
          if (insertedAd && insertedAd[0]) {
            setAds(prevAds => [insertedAd[0] as Ad, ...prevAds]);
          } else {
            setAds(prevAds => [newAd, ...prevAds]);
          }
        }

        // ÿ•ÿπÿßÿØÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        const currentAds = [newAd, ...ads];
        setStats(prev => ({
          ...prev,
          totalAds: currentAds.length
        }));

      } else if (modalType === 'notification') {
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÜÿ®ŸäŸá ÿ¨ÿØŸäÿØ (ŸÜÿµ 30 ÿ≠ÿ±ŸÅ)
        const newNotification: Notification = {
          id: Date.now().toString(),
          message: formData.message,
          created_at: new Date().toISOString()
        };

        // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        console.log('üîÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá ÿ•ŸÑŸâ Supabase...');
        const { data: insertedNotification, error } = await supabase
          .from('notifications')
          .insert([{
            message: formData.message
          }])
          .select();

        if (error) {
          console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá ÿ•ŸÑŸâ Supabase:', error);
          console.log('‚ö†Ô∏è  ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≠ŸÑŸäÿßŸã ŸÅŸÇÿ∑');
          setNotifications(prevNotifications => [newNotification, ...prevNotifications]);
        } else {
          console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá ÿ•ŸÑŸâ Supabase ÿ®ŸÜÿ¨ÿßÿ≠:', insertedNotification);
          if (insertedNotification && insertedNotification[0]) {
            setNotifications(prevNotifications => [insertedNotification[0] as Notification, ...prevNotifications]);
          } else {
            setNotifications(prevNotifications => [newNotification, ...prevNotifications]);
          }
        }

        // ÿ•ÿπÿßÿØÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        const currentNotifications = [newNotification, ...notifications];
        setStats(prev => ({
          ...prev,
          totalNotifications: currentNotifications.length
        }));

      } else if (modalType === 'slogan') {
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ¥ÿπÿßÿ± ÿ¨ÿØŸäÿØ (ÿπŸÜŸàÿßŸÜ + ŸÜÿµ 120 ÿ≠ÿ±ŸÅ)
        const newSlogan: Slogan = {
          id: Date.now().toString(),
          title: formData.title,
          slogan_text: formData.slogan_text,
          created_at: new Date().toISOString()
        };

        // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        console.log('üîÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¥ÿπÿßÿ± ÿ•ŸÑŸâ Supabase...');
        const { data: insertedSlogan, error } = await supabase
          .from('slogans')
          .insert([{
            title: formData.title,
            slogan_text: formData.slogan_text
          }])
          .select();

        if (error) {
          console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¥ÿπÿßÿ± ÿ•ŸÑŸâ Supabase:', error);
          console.log('‚ö†Ô∏è  ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≠ŸÑŸäÿßŸã ŸÅŸÇÿ∑');
          setSlogans(prevSlogans => [newSlogan, ...prevSlogans]);
        } else {
          console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¥ÿπÿßÿ± ÿ•ŸÑŸâ Supabase ÿ®ŸÜÿ¨ÿßÿ≠:', insertedSlogan);
          if (insertedSlogan && insertedSlogan[0]) {
            setSlogans(prevSlogans => [insertedSlogan[0] as Slogan, ...prevSlogans]);
          } else {
            setSlogans(prevSlogans => [newSlogan, ...prevSlogans]);
          }
        }

        // ÿ•ÿπÿßÿØÿ© ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
        const currentSlogans = [newSlogan, ...slogans];
        setStats(prev => ({
          ...prev,
          totalSlogans: currentSlogans.length
        }));
      }

      setShowCreateModal(false);
      resetForm();

    } catch (error) {
      console.error('Error creating item:', error);
      setError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿπŸÜÿµÿ±');
    }
  };

  const handleDelete = async (item: Ad | Notification | Slogan) => {
    if (!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿπŸÜÿµÿ±ÿü')) return;

    try {
      let table: string;
      if ('image_url' in item) {
        table = 'ads';
      } else if ('slogan_text' in item) {
        table = 'slogans';
      } else {
        table = 'notifications';
      }
      
      console.log(`üîÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ≠ÿ∞ŸÅ ${table === 'ads' ? 'ÿßŸÑÿ•ÿπŸÑÿßŸÜ' : table === 'notifications' ? 'ÿßŸÑÿ™ŸÜÿ®ŸäŸá' : 'ÿßŸÑÿ¥ÿπÿßÿ±'} ŸÖŸÜ Supabase...`);
      const { error } = await supabase
        .from(table)
        .delete()
        .eq('id', item.id);

      if (error) {
        console.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ${table} ŸÖŸÜ Supabase:`, error);
        console.log('‚ö†Ô∏è  ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ ŸÖÿ≠ŸÑŸäÿßŸã ŸÅŸÇÿ∑');
      } else {
        console.log(`‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ${table} ŸÖŸÜ Supabase ÿ®ŸÜÿ¨ÿßÿ≠`);
      }

      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©
      if (table === 'ads') {
        setAds(prevAds => prevAds.filter(ad => ad.id !== item.id));
        setStats(prev => ({ ...prev, totalAds: prev.totalAds - 1 }));
      } else if (table === 'notifications') {
        setNotifications(prevNotifications => prevNotifications.filter(notification => notification.id !== item.id));
        setStats(prev => ({ ...prev, totalNotifications: prev.totalNotifications - 1 }));
      } else {
        setSlogans(prevSlogans => prevSlogans.filter(slogan => slogan.id !== item.id));
        setStats(prev => ({ ...prev, totalSlogans: prev.totalSlogans - 1 }));
      }

    } catch (error) {
      console.error('Error deleting item:', error);
      setError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿπŸÜÿµÿ±');
    }
  };

  if (error) {
    return (
      <Layout>
        <div className="text-center py-12">
          <AlertTriangle className="h-12 w-12 text-red-400 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</h3>
          <p className="text-gray-600 mb-4">{error}</p>
          <Button onClick={fetchData} className="bg-blue-500 text-white">
            ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
          </Button>
        </div>
      </Layout>
    );
  }

  return (
    <Layout>
      {/* Header */}
      <div className="mb-8">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸàÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™</h1>
            <p className="text-gray-600">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸàÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ŸàÿßŸÑÿ¥ÿπÿßÿ±ÿßÿ™</p>
          </div>
          <div className="flex items-center gap-3">
            <Button 
              onClick={fetchData}
              disabled={loading}
              className="flex items-center gap-2 border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
            >
              <RefreshCw className={`h-4 w-4 ${loading ? 'animate-spin' : ''}`} />
              {loading ? 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´...' : 'ÿ™ÿ≠ÿØŸäÿ´'}
            </Button>
            <Button 
              onClick={() => setShowCreateModal(true)}
              className="bg-blue-500 text-white hover:bg-blue-600"
            >
              <Plus className="h-4 w-4 ml-2" />
              ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ÿØŸäÿØ
            </Button>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <Card className="bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-blue-600 mb-1">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</p>
                <p className="text-2xl font-bold text-blue-900">{stats.totalAds}</p>
                <p className="text-sm text-blue-600">ÿ•ÿπŸÑÿßŸÜ</p>
              </div>
              <div className="p-3 rounded-xl bg-blue-500">
                <Megaphone className="h-6 w-6 text-white" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-orange-600 mb-1">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™</p>
                <p className="text-2xl font-bold text-orange-900">{stats.totalNotifications}</p>
                <p className="text-sm text-orange-600">ÿ™ŸÜÿ®ŸäŸá</p>
              </div>
              <div className="p-3 rounded-xl bg-orange-500">
                <Bell className="h-6 w-6 text-white" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200">
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-medium text-purple-600 mb-1">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ¥ÿπÿßÿ±ÿßÿ™</p>
                <p className="text-2xl font-bold text-purple-900">{stats.totalSlogans}</p>
                <p className="text-sm text-purple-600">ÿ¥ÿπÿßÿ±</p>
              </div>
              <div className="p-3 rounded-xl bg-purple-500">
                <Type className="h-6 w-6 text-white" />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Tabs */}
      <div className="mb-6">
        <div className="border-b border-gray-200">
          <nav className="-mb-px flex space-x-8" aria-label="Tabs">
            <button
              onClick={() => setActiveTab('ads')}
              className={`py-2 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'ads'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
            >
              <Megaphone className="h-4 w-4 ml-2 inline" />
              ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ({ads.length})
            </button>
            <button
              onClick={() => setActiveTab('notifications')}
              className={`py-2 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'notifications'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
            >
              <Bell className="h-4 w-4 ml-2 inline" />
              ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ({notifications.length})
            </button>
            <button
              onClick={() => setActiveTab('slogans')}
              className={`py-2 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'slogans'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
              }`}
            >
              <Type className="h-4 w-4 ml-2 inline" />
              ÿßŸÑÿ¥ÿπÿßÿ±ÿßÿ™ ({slogans.length})
            </button>
          </nav>
        </div>
      </div>

      {/* Content */}
      {activeTab === 'ads' && (
        <div className="space-y-6">
          {ads.length === 0 ? (
            <Card>
              <CardContent className="p-12 text-center">
                <Megaphone className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿπŸÑÿßŸÜÿßÿ™</h3>
                <p className="text-gray-600 mb-4">ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ</p>
                <Button onClick={() => setShowCreateModal(true)} className="bg-blue-500 text-white">
                  <Plus className="h-4 w-4 ml-2" />
                  ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {ads.map((ad) => (
                <Card key={ad.id} className="hover:shadow-lg transition-shadow duration-300">
                  <CardContent className="p-4">
                    <div className="mb-4">
                      <img 
                        src={ad.image_url} 
                        alt="ÿ•ÿπŸÑÿßŸÜ"
                        className="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <div className="text-sm text-gray-600">
                      <div className="flex items-center gap-2">
                        <Calendar className="h-4 w-4" />
                        <span>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: {new Date(ad.created_at).toLocaleDateString('ar-SA')}</span>
                      </div>
                    </div>
                  </CardContent>
                  <CardFooter className="pt-0">
                    <div className="flex items-center gap-2 w-full">
                      <Button
                        onClick={() => setEditingItem(ad)}
                        className="flex-1 px-3 py-1.5 text-xs border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                      >
                        <Edit className="h-4 w-4" />
                        ÿ™ÿπÿØŸäŸÑ
                      </Button>
                      <Button
                        onClick={() => handleDelete(ad)}
                        className="px-3 py-1.5 text-xs border border-gray-300 bg-white text-red-600 hover:text-red-700 hover:bg-red-50"
                      >
                        <Trash2 className="h-4 w-4" />
                      </Button>
                    </div>
                  </CardFooter>
                </Card>
              ))}
            </div>
          )}
        </div>
      )}

      {activeTab === 'notifications' && (
        <div className="space-y-6">
          {notifications.length === 0 ? (
            <Card>
              <CardContent className="p-12 text-center">
                <Bell className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÜÿ®ŸäŸáÿßÿ™</h3>
                <p className="text-gray-600 mb-4">ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÜÿ®ŸäŸá ÿ¨ÿØŸäÿØ</p>
                <Button onClick={() => setShowCreateModal(true)} className="bg-blue-500 text-white">
                  <Plus className="h-4 w-4 ml-2" />
                  ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÜÿ®ŸäŸá ÿ¨ÿØŸäÿØ
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="space-y-4">
              {notifications.map((notification) => (
                <Card key={notification.id} className="hover:shadow-lg transition-shadow duration-300">
                  <CardHeader className="pb-4">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="p-2 rounded-lg bg-blue-100">
                          <Bell className="h-5 w-5 text-blue-600" />
                        </div>
                        <div>
                          <CardTitle className="text-lg">{notification.message}</CardTitle>
                        </div>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent className="pb-4">
                    <div className="space-y-2 text-sm text-gray-600">
                      <div className="flex items-center gap-2">
                        <Calendar className="h-4 w-4" />
                        <span>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: {new Date(notification.created_at).toLocaleDateString('ar-SA')}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <span className="text-xs bg-gray-100 px-2 py-1 rounded">
                          {notification.message.length}/30 ÿ≠ÿ±ŸÅ
                        </span>
                      </div>
                    </div>
                  </CardContent>
                  <CardFooter className="pt-0">
                    <div className="flex items-center gap-2 w-full">
                      <Button
                        onClick={() => setEditingItem(notification)}
                        className="flex-1 px-3 py-1.5 text-xs border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                      >
                        <Edit className="h-4 w-4" />
                        ÿ™ÿπÿØŸäŸÑ
                      </Button>
                      <Button
                        onClick={() => handleDelete(notification)}
                        className="px-3 py-1.5 text-xs border border-gray-300 bg-white text-red-600 hover:text-red-700 hover:bg-red-50"
                      >
                        <Trash2 className="h-4 w-4" />
                      </Button>
                    </div>
                  </CardFooter>
                </Card>
              ))}
            </div>
          )}
        </div>
      )}

      {activeTab === 'slogans' && (
        <div className="space-y-6">
          {slogans.length === 0 ? (
            <Card>
              <CardContent className="p-12 text-center">
                <Type className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¥ÿπÿßÿ±ÿßÿ™</h3>
                <p className="text-gray-600 mb-4">ÿßÿ®ÿØÿ£ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ÿ¥ÿπÿßÿ± ÿ¨ÿØŸäÿØ</p>
                <Button onClick={() => setShowCreateModal(true)} className="bg-blue-500 text-white">
                  <Plus className="h-4 w-4 ml-2" />
                  ÿ•ÿ∂ÿßŸÅÿ© ÿ¥ÿπÿßÿ± ÿ¨ÿØŸäÿØ
                </Button>
              </CardContent>
            </Card>
          ) : (
            <div className="space-y-4">
              {slogans.map((slogan) => (
                <Card key={slogan.id} className="hover:shadow-lg transition-shadow duration-300">
                  <CardHeader className="pb-4">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="p-2 rounded-lg bg-purple-100">
                          <Type className="h-5 w-5 text-purple-600" />
                        </div>
                        <div>
                          <CardTitle className="text-lg">{slogan.title}</CardTitle>
                          <p className="text-sm text-gray-600 mt-1">{slogan.slogan_text}</p>
                        </div>
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent className="pb-4">
                    <div className="space-y-2 text-sm text-gray-600">
                      <div className="flex items-center gap-2">
                        <Calendar className="h-4 w-4" />
                        <span>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: {new Date(slogan.created_at).toLocaleDateString('ar-SA')}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <span className="text-xs bg-gray-100 px-2 py-1 rounded">
                          {slogan.slogan_text.length}/120 ÿ≠ÿ±ŸÅ
                        </span>
                      </div>
                    </div>
                  </CardContent>
                  <CardFooter className="pt-0">
                    <div className="flex items-center gap-2 w-full">
                      <Button
                        onClick={() => setEditingItem(slogan)}
                        className="flex-1 px-3 py-1.5 text-xs border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                      >
                        <Edit className="h-4 w-4" />
                        ÿ™ÿπÿØŸäŸÑ
                      </Button>
                      <Button
                        onClick={() => handleDelete(slogan)}
                        className="px-3 py-1.5 text-xs border border-gray-300 bg-white text-red-600 hover:text-red-700 hover:bg-red-50"
                      >
                        <Trash2 className="h-4 w-4" />
                      </Button>
                    </div>
                  </CardFooter>
                </Card>
              ))}
            </div>
          )}
        </div>
      )}

      {/* Create/Edit Modal */}
      {showCreateModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-xl font-bold">
                {modalType === 'ad' ? 'ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ' : 
                 modalType === 'notification' ? 'ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÜÿ®ŸäŸá ÿ¨ÿØŸäÿØ' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿ¥ÿπÿßÿ± ÿ¨ÿØŸäÿØ'}
              </h3>
              <Button
                onClick={() => {
                  setShowCreateModal(false);
                  resetForm();
                }}
                className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg"
              >
                <X className="h-5 w-5" />
              </Button>
            </div>

            {/* Type Selection */}
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">ŸÜŸàÿπ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ</label>
              <div className="flex gap-2">
                <Button
                  onClick={() => setModalType('ad')}
                  className={`flex-1 ${modalType === 'ad' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700'}`}
                >
                  <Megaphone className="h-4 w-4 ml-2" />
                  ÿ•ÿπŸÑÿßŸÜ
                </Button>
                <Button
                  onClick={() => setModalType('notification')}
                  className={`flex-1 ${modalType === 'notification' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700'}`}
                >
                  <Bell className="h-4 w-4 ml-2" />
                  ÿ™ŸÜÿ®ŸäŸá
                </Button>
                <Button
                  onClick={() => setModalType('slogan')}
                  className={`flex-1 ${modalType === 'slogan' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700'}`}
                >
                  <Type className="h-4 w-4 ml-2" />
                  ÿ¥ÿπÿßÿ±
                </Button>
              </div>
            </div>

            {/* Form */}
            <div className="space-y-4">
              {/* Image Upload for Ads */}
              {modalType === 'ad' && (
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">ÿµŸàÿ±ÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ</label>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    {imagePreview ? (
                      <div className="space-y-4">
                        <img
                          src={imagePreview}
                          alt="Preview"
                          className="mx-auto max-h-48 rounded-lg"
                        />
                        <Button
                          onClick={() => {
                            setSelectedImage(null);
                            setImagePreview('');
                          }}
                          className="px-3 py-1.5 text-xs border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                        >
                          <X className="h-4 w-4 ml-1" />
                          ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿµŸàÿ±ÿ©
                        </Button>
                      </div>
                    ) : (
                      <div>
                        <ImageIcon className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                        <div className="space-y-2">
                          <Button
                            onClick={() => document.getElementById('image-upload')?.click()}
                            className="bg-blue-500 text-white hover:bg-blue-600"
                          >
                            <Upload className="h-4 w-4 ml-2" />
                            ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ©
                          </Button>
                          <p className="text-sm text-gray-500">PNG, JPG ÿ≠ÿ™Ÿâ 5MB</p>
                        </div>
                      </div>
                    )}
                    <input
                      id="image-upload"
                      type="file"
                      accept="image/*"
                      onChange={(e) => {
                        const file = e.target.files?.[0];
                        if (file) {
                          setSelectedImage(file);
                          const reader = new FileReader();
                          reader.onload = (e) => {
                            setImagePreview(e.target?.result as string);
                          };
                          reader.readAsDataURL(file);
                        }
                      }}
                      className="hidden"
                    />
                  </div>
                </div>
              )}

              {/* Message for Notifications */}
              {modalType === 'notification' && (
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá <span className="text-red-500">*</span>
                    <span className="text-xs text-gray-500 mr-2">(30 ÿ≠ÿ±ŸÅ ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)</span>
                  </label>
                  <textarea
                    value={formData.message}
                    onChange={(e) => {
                      const value = e.target.value;
                      if (value.length <= 30) {
                        setFormData({...formData, message: value});
                      }
                    }}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows={3}
                    placeholder="ÿ£ÿØÿÆŸÑ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá (30 ÿ≠ÿ±ŸÅ ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)"
                    maxLength={30}
                  />
                  <div className="text-xs text-gray-500 mt-1">
                    {formData.message.length}/30 ÿ≠ÿ±ŸÅ
                  </div>
                </div>
              )}

              {/* Title and Slogan Text for Slogans */}
              {modalType === 'slogan' && (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ¥ÿπÿßÿ± <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      value={formData.title}
                      onChange={(e) => setFormData({...formData, title: e.target.value})}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ¥ÿπÿßÿ±"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ŸÜÿµ ÿßŸÑÿ¥ÿπÿßÿ± <span className="text-red-500">*</span>
                      <span className="text-xs text-gray-500 mr-2">(120 ÿ≠ÿ±ŸÅ ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)</span>
                    </label>
                    <textarea
                      value={formData.slogan_text}
                      onChange={(e) => {
                        const value = e.target.value;
                        if (value.length <= 120) {
                          setFormData({...formData, slogan_text: value});
                        }
                      }}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      rows={4}
                      placeholder="ÿ£ÿØÿÆŸÑ ŸÜÿµ ÿßŸÑÿ¥ÿπÿßÿ± (120 ÿ≠ÿ±ŸÅ ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)"
                      maxLength={120}
                    />
                    <div className="text-xs text-gray-500 mt-1">
                      {formData.slogan_text.length}/120 ÿ≠ÿ±ŸÅ
                    </div>
                  </div>
                </>
              )}
            </div>

            {/* Actions */}
            <div className="flex gap-3 mt-6">
              <Button
                onClick={() => {
                  setShowCreateModal(false);
                  resetForm();
                }}
                className="flex-1 px-3 py-2 border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
              >
                ÿ•ŸÑÿ∫ÿßÿ°
              </Button>
              <Button
                onClick={handleCreateItem}
                disabled={
                  (modalType === 'ad' && !imagePreview) ||
                  (modalType === 'notification' && !formData.message) ||
                  (modalType === 'slogan' && (!formData.title || !formData.slogan_text))
                }
                className="flex-1 bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50"
              >
                {modalType === 'ad' ? 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ' : 
                 modalType === 'notification' ? 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÜÿ®ŸäŸá' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ¥ÿπÿßÿ±'}
              </Button>
            </div>
          </div>
        </div>
      )}
    </Layout>
  );
}
